{% load crispy_forms_tags %}
{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Register | Novustell Travel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Add Google One Tap Script -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <!-- Your existing CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{% static '/css/style.css' %}">
    <link rel="stylesheet" href="{% static '/css/pack-style.css' %}">

    <style>
        /* Your existing styles */
        .gradient-custom-2 {
            background: #620079;
        }

        /* Style for Google One Tap button */
        .google-btn-container {
            margin: 20px 0;
            text-align: center;
        }

        @media (min-width: 768px) {
            .gradient-form {
                height: 100vh !important;
            }
        }
        @media (min-width: 769px) {
            .gradient-custom-2 {
                border-top-right-radius: .3rem;
                border-bottom-right-radius: .3rem;
            }
        }
    </style>
</head>
<body style="background-color: #620079;">
    <section class="h-100 gradient-form">
        <div class="container py-5 h-100">
            <div class="row d-flex justify-content-center align-items-center h-100">
                <div class="col-xl-10">
                    <div class="card rounded-3 text-black">
                        <div class="row g-0">
                            <div class="col-lg-6">
                                <div class="card-body p-md-5 mx-md-4" style="background-color: #ffffff;">
                                    <div class="text-center">
                                        <img src="{% static 'assets3/img/logo/dedelogo1.png' %}" style="width: 55%;" alt="image">
                                    </div>
                                    <br>

                                    <!-- Google One Tap Sign In -->
                                    <div class="google-btn-container">
                                        <div id="g_id_onload"
                                        data-client_id="{{ GOOGLE_CLIENT_ID }}"
                                        data-context="signup"
                                        data-ux_mode="popup"
                                        data-login_uri="{{ request.scheme }}://{{ request.get_host }}{% url 'users:google-one-tap' %}"
                                        data-auto_prompt="false"
                                        data-itp_support="true">
                                   </div>
                                   
                                   <div class="g_id_signin"
                                        data-type="standard"
                                        data-shape="rectangular"
                                        data-theme="outline"
                                        data-text="continue_with"
                                        data-size="large"
                                        data-logo_alignment="left">
                                   </div>
</div>
                                  

                                    <div class="text-center mb-4">
                                        <p>- OR -</p>
                                    </div>

                                    <!-- Your existing registration form -->
                                    <form method="POST">
                                        {% csrf_token %}
                                        <fieldset class="form-group">
                                            {{ form.non_field_errors }}
                                            {% for field in form %}
                                                <div class="mb-3">
                                                    {{ field.label_tag }}
                                                    {{ field }}
                                                    {% if field.help_text %}
                                                        <small class="form-text text-muted">{{ field.help_text }}</small>
                                                    {% endif %}
                                                    {% for error in field.errors %}
                                                        <div class="text-danger">{{ error }}</div>
                                                    {% endfor %}
                                                </div>
                                            {% endfor %}
                                        </fieldset>
                                        <div class="form-group">
                                            <button class="book-btn" style="background-color: #620079; color: #ffffff;" type='submit'>Sign Up</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <div class="col-lg-6 d-flex align-items-center">
                                <div class="text-center">
                                    <img src="{% static 'images/reg.jpeg ' %}" style="border-radius: 10px; width: 100%;" alt="image">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        function handleCredentialResponse(response) {
            console.log("Received credential response:", response);
            
            fetch('{% url "users:google-one-tap" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({
                    credential: response.credential
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log("Server response:", data);
                if (data.success) {
                    window.location.href = data.redirect_url;
                } else {
                    console.error('Login failed:', data.error);
                    alert('Login failed: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred during login');
            });
        }
    </script>
    <script>
        console.log("Google Client ID:", "{{ GOOGLE_CLIENT_ID }}");
        console.log("CSRF Token:", "{{ csrf_token }}");
    </script>
</body>
</html>